# 커스터디 시스템 권한 체계 설계서

## 개요

기업용 커스터디 시스템의 4단계 권한 체계를 정의하고, 각 권한별로 시스템의 모든 메뉴와 기능에 대한 접근 권한을 명확히 규정합니다.

## 권한 등급 정의

### 1. 관리자 (Administrator)

- **역할**: 시스템 전체 관리 및 최고 권한
- **특징**: 모든 권한을 보유한 슈퍼유저

### 2. 매니저 (Manager)

- **역할**: 정책 결정권자 및 승인자
- **특징**: 정책 생성/수정, 입출금 주소 관리, 운영자 요청 승인/반려 처리

### 3. 운영자 (Operator)

- **역할**: 실무 담당자 및 승인 요청자
- **특징**: 일상적인 업무 처리 및 상급자 승인 요청

### 4. 조회자 (Viewer)

- **역할**: 데이터 조회 및 회계 업무
- **특징**: 읽기 전용 권한, CSV 다운로드 가능

## 상세 권한 매트릭스

### 1. 개요 (Overview) - 대시보드

| 기능             | 관리자 | 매니저 | 운영자 | 조회자 |
| ---------------- | :----: | :----: | :----: | :----: |
| 대시보드 조회    |   ✅   |   ✅   |   ✅   |   ✅   |
| 자산 현황 조회   |   ✅   |   ✅   |   ✅   |   ✅   |
| 통계 데이터 조회 |   ✅   |   ✅   |   ✅   |   ✅   |
| 차트/그래프 조회 |   ✅   |   ✅   |   ✅   |   ✅   |

### 2. 거래내역 (Transactions)

| 기능                | 관리자 | 매니저 | 운영자 | 조회자 |
| ------------------- | :----: | :----: | :----: | :----: |
| 거래내역 조회       |   ✅   |   ✅   |   ✅   |   ✅   |
| 상세 거래 정보 조회 |   ✅   |   ✅   |   ✅   |   ✅   |
| CSV 다운로드        |   ✅   |   ✅   |   ✅   |   ✅   |
| 거래 검색/필터링    |   ✅   |   ✅   |   ✅   |   ✅   |
| 거래 취소/수정      |   ✅   |   ✅   |   ❌   |   ❌   |

### 3. 사용자 관리 (Users)

| 기능                 | 관리자 | 매니저 | 운영자 | 조회자 |
| -------------------- | :----: | :----: | :----: | :----: |
| 사용자 목록 조회     |   ✅   |   ✅   |   ❌   |   ❌   |
| 사용자 상세정보 조회 |   ✅   |   ✅   |   ❌   |   ❌   |
| 사용자 생성          |   ✅   |   ✅   |   ❌   |   ❌   |
| 사용자 정보 수정     |   ✅   |   ✅   |   ❌   |   ❌   |
| 사용자 정지/해제     |   ✅   |   ✅   |   ❌   |   ❌   |
| 권한 설정            |   ✅   |   ❌   |   ❌   |   ❌   |

### 4. 그룹 관리 (Groups)

| 기능                | 관리자 | 매니저 | 운영자 | 조회자 |
| ------------------- | :----: | :----: | :----: | :----: |
| 그룹 목록 조회      |   ✅   |   ✅   |   ✅   |   ✅   |
| 그룹 상세정보 조회  |   ✅   |   ✅   |   ✅   |   ✅   |
| 그룹 생성           |   ✅   |   ✅   |   ✅   |   ❌   |
| 그룹 예산 설정      |   ✅   |   ✅   |   ✅   |   ❌   |
| 그룹 승인자 지정    |   ✅   |   ✅   |   ✅   |   ❌   |
| 그룹 지출 신청      |   ✅   |   ✅   |   ✅   |   ❌   |
| 그룹 지출 승인/반려 |   ✅   |   ✅   |   ❌   |   ❌   |
| 그룹 삭제/비활성화  |   ✅   |   ✅   |   ❌   |   ❌   |

### 5. 입금 관리 (Deposit) - 엔터프라이즈만

| 기능           | 관리자 | 매니저 | 운영자 | 조회자 |
| -------------- | :----: | :----: | :----: | :----: |
| 입금 현황 조회 |   ✅   |   ✅   |   ✅   |   ✅   |
| 입금 내역 조회 |   ✅   |   ✅   |   ✅   |   ✅   |
| 입금 처리      |   ✅   |   ✅   |   ✅   |   ❌   |
| 입금 확인      |   ✅   |   ✅   |   ✅   |   ❌   |
| 입금 취소/환불 |   ✅   |   ✅   |   ❌   |   ❌   |

### 6. 출금 관리 (Withdrawal) - 엔터프라이즈만

| 기능           | 관리자 | 매니저 | 운영자 | 조회자 |
| -------------- | :----: | :----: | :----: | :----: |
| 출금 현황 조회 |   ✅   |   ✅   |   ✅   |   ✅   |
| 출금 요청 조회 |   ✅   |   ✅   |   ✅   |   ✅   |
| 출금 요청 생성 |   ✅   |   ✅   |   ✅   |   ❌   |
| 출금 요청 처리 |   ✅   |   ✅   |   ✅   |   ❌   |
| 출금 승인/반려 |   ✅   |   ✅   |   ❌   |   ❌   |
| 출금 중단/취소 |   ✅   |   ✅   |   ✅   |   ❌   |
| 긴급 출금 중단 |   ✅   |   ✅   |   ✅   |   ❌   |

### 7. 부가 서비스 (Services)

| 기능             | 관리자 | 매니저 | 운영자 | 조회자 |
| ---------------- | :----: | :----: | :----: | :----: |
| 서비스 설정 조회 |   ✅   |   ✅   |   ✅   |   ✅   |
| 서비스 설정 변경 |   ✅   |   ✅   |   ❌   |   ❌   |
| API 키 관리      |   ✅   |   ✅   |   ❌   |   ❌   |
| 웹훅 설정        |   ✅   |   ✅   |   ❌   |   ❌   |

### 8. 보안 설정 (Security)

#### 8.1 보안 설정 (Security Tab)

| 기능                 | 관리자 | 매니저 | 운영자 | 조회자 |
| -------------------- | :----: | :----: | :----: | :----: |
| 보안 설정 조회       |   ✅   |   ✅   |   ✅   |   ✅   |
| 2FA 설정 관리        |   ✅   |   ✅   |   ❌   |   ❌   |
| SMS 인증 관리        |   ✅   |   ✅   |   ❌   |   ❌   |
| IP 화이트리스트 관리 |   ✅   |   ✅   |   ❌   |   ❌   |
| 관리자 접근 모니터링 |   ✅   |   ✅   |   ✅   |   ✅   |

#### 8.2 주소 관리 (Addresses)

| 기능             | 관리자 | 매니저 | 운영자 | 조회자 |
| ---------------- | :----: | :----: | :----: | :----: |
| 주소 목록 조회   |   ✅   |   ✅   |   ✅   |   ✅   |
| 개인 주소 조회   |   ✅   |   ✅   |   ✅   |   ✅   |
| VASP 주소 조회   |   ✅   |   ✅   |   ✅   |   ✅   |
| 입금 주소 등록   |   ✅   |   ✅   |   ❌   |   ❌   |
| 출금 주소 등록   |   ✅   |   ✅   |   ❌   |   ❌   |
| 주소 수정/삭제   |   ✅   |   ✅   |   ❌   |   ❌   |
| Travel Rule 관리 |   ✅   |   ✅   |   ❌   |   ❌   |

#### 8.3 계좌 연동 (Accounts)

| 기능                 | 관리자 | 매니저 | 운영자 | 조회자 |
| -------------------- | :----: | :----: | :----: | :----: |
| 연동 계좌 조회       |   ✅   |   ✅   |   ✅   |   ✅   |
| 은행 계좌 등록       |   ✅   |   ✅   |   ❌   |   ❌   |
| 계좌 인증 (1원 인증) |   ✅   |   ✅   |   ❌   |   ❌   |
| 계좌 수정/삭제       |   ✅   |   ✅   |   ❌   |   ❌   |

#### 8.4 정책 관리 (Policies)

| 기능             | 관리자 | 매니저 | 운영자 | 조회자 |
| ---------------- | :----: | :----: | :----: | :----: |
| 정책 목록 조회   |   ✅   |   ✅   |   ✅   |   ✅   |
| 금액별 정책 조회 |   ✅   |   ✅   |   ✅   |   ✅   |
| 유형별 정책 조회 |   ✅   |   ✅   |   ✅   |   ✅   |
| 정책 생성        |   ✅   |   ✅   |   ❌   |   ❌   |
| 정책 수정        |   ✅   |   ✅   |   ❌   |   ❌   |
| 정책 정지/활성화 |   ✅   |   ✅   |   ❌   |   ❌   |
| 정책 삭제        |   ✅   |   ❌   |   ❌   |   ❌   |
| 정책 로그 조회   |   ✅   |   ✅   |   ✅   |   ✅   |

#### 8.5 알림 설정 (Notifications)

| 기능             | 관리자 | 매니저 | 운영자 | 조회자 |
| ---------------- | :----: | :----: | :----: | :----: |
| 알림 로그 조회   |   ✅   |   ✅   |   ✅   |   ✅   |
| 알림 템플릿 조회 |   ✅   |   ✅   |   ✅   |   ✅   |
| 알림 설정 조회   |   ✅   |   ✅   |   ✅   |   ✅   |
| 알림 템플릿 수정 |   ✅   |   ✅   |   ❌   |   ❌   |
| 알림 설정 변경   |   ✅   |   ✅   |   ❌   |   ❌   |

## 권한 상속 구조

```
관리자 (Administrator)
├── 모든 권한 보유
├── 시스템 전체 관리
└── 권한 설정 가능

매니저 (Manager)
├── 정책 생성/수정/정지
├── 입출금 주소 관리
├── 승인/반려 처리
├── 사용자 관리 (권한 설정 제외)
└── 운영자 권한 포함

운영자 (Operator)
├── 입출금 처리
├── 그룹 관리 (생성/예산 설정)
├── 출금 요청 처리
├── 긴급 출금 중단
└── 조회자 권한 포함

조회자 (Viewer)
├── 모든 데이터 조회
├── CSV 다운로드
├── 대시보드 접근
└── 읽기 전용 권한
```

## 특별 권한 규칙

### 1. 승인 프로세스

- **정책 기반 승인**: 매니저가 정책에서 금액별 승인자를 지정
- **즉시 적용**: 매니저의 정책 생성/수정은 즉시 적용 (관리자 승인 불필요)
- **로그 기록**: 모든 정책 변경 사항은 자동으로 로그 기록

### 2. 그룹 관리 특수 규칙

- **예산 설정**: 운영자가 그룹 생성 시 예산 설정
- **승인자 지정**: 운영자가 특정 매니저 이상급을 승인자로 지정
- **지출 프로세스**: 그룹 예산 지출 시 출금 승인 프로세스 적용

### 3. 긴급 상황 대응

- **출금 중단**: 운영자 이상급에서 긴급 출금 중단 가능
- **정책 정지**: 매니저 이상급에서 정책 임시 정지 가능

### 4. 조회 권한 특별 규칙

- **전체 데이터 접근**: 조회자는 커스터디 관리 모든 데이터 조회 가능
- **CSV 다운로드**: 회계 업무를 위한 데이터 추출 권한
- **사용자 관리 제한**: 사용자 관리 메뉴는 매니저 이상급만 접근

## 구현 고려사항

### 1. 기술적 구현

- **Role-Based Access Control (RBAC)** 모델 적용
- **권한 체크 미들웨어**를 통한 API 수준 권한 제어
- **프론트엔드 권한 표시**를 통한 UI/UX 최적화

### 2. 보안 고려사항

- **최소 권한 원칙** 적용
- **권한 변경 로그** 필수 기록
- **세션 기반 권한 검증** 실시간 적용

### 3. 확장성 고려

- **권한 등급 추가** 가능한 구조
- **메뉴별 세부 권한** 추가 설정 가능
- **역할별 대시보드** 커스터마이징 지원

## 결론

본 권한 체계는 기업용 커스터디 시스템의 보안성과 운영 효율성을 동시에 확보하며, 각 역할별 업무 특성을 반영한 현실적인 권한 분배를 통해 안전하고 효율적인 시스템 운영을 지원합니다.
