# /login/blocked 페이지 검증 리포트

## 개요

본 리포트는 `/login/blocked` 페이지의 동작을 검증하기 위해 수행된 테스트 결과를 정리한 문서입니다. Playwright를 사용하여 다양한 시나리오에서 페이지의 동작을 체계적으로 검증했습니다.

## 테스트 환경

- **개발 서버**: localhost:3000 (Next.js 14)
- **테스트 도구**: Playwright (Chromium 브라우저)
- **테스트 일시**: 2025년 9월 21일
- **페이지 경로**: `/src/app/login/blocked/page.tsx`

## 테스트 결과 요약

### 1. 직접 URL 접근 테스트 (파라미터 없음)

**결과**: ✅ **정상 동작**
- **동작**: `/login/blocked` 접근 시 `/login`으로 리다이렉트
- **예상**: 파라미터 없이 접근하면 로그인 페이지로 리다이렉트
- **실제**: 예상대로 동작함

### 2. 유효하지 않은 파라미터로 접근 테스트

**결과**: ✅ **정상 동작**
- **테스트 케이스**:
  - 과거 시간 (1분 전)
  - 현재 시간 (만료된 상태)
  - 너무 긴 차단 시간 (2시간 후)
  - 잘못된 형식 (`until=invalid`)
- **동작**: 모든 경우에서 `/login`으로 리다이렉트
- **예상**: 유효하지 않은 파라미터는 로그인 페이지로 리다이렉트
- **실제**: 예상대로 동작함

### 3. 유효한 파라미터로 접근 테스트

**결과**: ❌ **심각한 문제 발견**
- **테스트 케이스**:
  - 1분 후 차단 해제
  - 30분 후 차단 해제
  - 59분 후 차단 해제 (경계값)
- **예상**: blocked 페이지에 머물러서 카운트다운 타이머 표시
- **실제**: 모든 유효한 파라미터에도 불구하고 `/login`으로 리다이렉트됨

## 심층 분석 결과

### 코드 로직 분석

디버깅 테스트를 통해 확인된 내용:

```javascript
=== 디버그 정보 ===
URL until 파라미터: 1758438176131
파싱된 until: 1758438176131
현재 시간: 1758437998436
isNaN 체크: false
만료 여부: false
너무 긴 시간 여부: false
리다이렉트 해야 하는가: false
```

**핵심 문제점**: 모든 유효성 검사를 통과했음에도 불구하고 여전히 로그인 페이지로 리다이렉트되고 있음.

### 가능한 원인 분석

1. **Next.js 렌더링 이슈**
   - 서버 사이드 렌더링과 클라이언트 사이드 렌더링 간의 불일치
   - `useEffect` 실행 타이밍 문제

2. **useSearchParams 관련 이슈**
   - Next.js App Router에서 `useSearchParams` Hook의 동작 문제
   - 파라미터 읽기 실패 또는 지연

3. **라우터 동작 문제**
   - `router.replace()` 호출이 예상과 다르게 동작
   - 중복 리다이렉트 발생

4. **브라우저 캐싱 문제**
   - 이전 리다이렉트 결과가 캐시되어 영향을 미침

## 테스트 상세 결과

### 시나리오별 테스트 결과

| 시나리오 | 예상 결과 | 실제 결과 | 상태 |
|---------|----------|----------|------|
| 파라미터 없음 | 로그인 페이지 리다이렉트 | 로그인 페이지 리다이렉트 | ✅ 통과 |
| 과거 시간 | 로그인 페이지 리다이렉트 | 로그인 페이지 리다이렉트 | ✅ 통과 |
| 현재 시간 | 로그인 페이지 리다이렉트 | 로그인 페이지 리다이렉트 | ✅ 통과 |
| 1분 후 (유효) | blocked 페이지 유지 | 로그인 페이지 리다이렉트 | ❌ 실패 |
| 30분 후 (유효) | blocked 페이지 유지 | 로그인 페이지 리다이렉트 | ❌ 실패 |
| 59분 후 (유효) | blocked 페이지 유지 | 로그인 페이지 리다이렉트 | ❌ 실패 |
| 61분 후 (무효) | 로그인 페이지 리다이렉트 | 로그인 페이지 리다이렉트 | ✅ 통과 |
| 잘못된 형식 | 로그인 페이지 리다이렉트 | 로그인 페이지 리다이렉트 | ✅ 통과 |

### UI 요소 검증 불가능

유효한 파라미터로 blocked 페이지에 접근할 수 없어 다음 요소들의 검증이 불가능했습니다:

1. **페이지 UI 요소**
   - 차단 메시지 표시
   - 경고 아이콘 렌더링
   - 안내 정보 표시

2. **카운트다운 타이머**
   - 실시간 업데이트
   - 시간 형식 (MM:SS)
   - 타이머 만료 시 자동 리다이렉트

3. **버튼 기능**
   - "관리자에게 문의" 버튼
   - "로그인 페이지로 돌아가기" 버튼

4. **반응형 디자인**
   - 모바일/데스크톱 뷰포트 적응

## 권장 사항

### 즉시 수정 필요

1. **blocked 페이지 접근 문제 해결**
   - `useEffect` 의존성 배열 확인
   - `useSearchParams` 사용 방식 검토
   - Next.js App Router 호환성 확인

2. **디버깅 로그 추가**
   ```javascript
   useEffect(() => {
     console.log('Blocked page - URL params:', searchParams.toString());
     console.log('Blocked page - blockedUntil:', blockedUntil);
     console.log('Blocked page - current time:', Date.now());
     // ... 기존 로직
   }, [blockedUntil, router, searchParams]);
   ```

3. **조건부 렌더링 검토**
   - `isValidating` 상태 관리 확인
   - 렌더링 조건 재검토

### 추가 개선 사항

1. **테스트 케이스 보완**
   - 실제 인증 시스템과 연동된 테스트
   - 브라우저 간 호환성 테스트

2. **사용자 경험 개선**
   - 로딩 상태 개선
   - 에러 처리 강화

3. **보안 검토**
   - URL 파라미터 조작 방지
   - 차단 시간 검증 강화

## 결론

현재 `/login/blocked` 페이지는 **유효한 파라미터로 접근하는 시나리오에서 작동하지 않는 심각한 문제**가 있습니다.

- **정상 동작**: 무효한 파라미터에 대한 리다이렉트 처리
- **문제점**: 유효한 파라미터에도 불구하고 항상 리다이렉트됨
- **영향도**: 높음 - 실제 사용자가 차단된 상황에서 페이지를 볼 수 없음

이 문제는 실제 운영 환경에서 사용자가 로그인 차단 상태를 제대로 인지할 수 없게 만들어, 보안 정책의 투명성과 사용자 경험에 부정적인 영향을 미칠 수 있습니다.

**우선순위**: 🔴 **긴급** - 즉시 수정 필요

---

**테스트 수행자**: Claude Code
**검증 도구**: Playwright E2E Testing
**생성일**: 2025년 9월 21일