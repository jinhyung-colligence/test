# 지갑 등록 시스템 요구사항

> 📋 **작업 예정**: `/security/addresses` 페이지 수정 예정 (내일 작업)

## 1. 지갑 등록 시스템

### 1.1 기본 원칙

- **모든 입금/출금은 사전 등록된 지갑 주소에서만 가능**
- **지갑 유형에 따른 차별화된 등록 프로세스 구현**

### 1.2 지갑 유형별 등록 절차

#### 개인 지갑 등록

```
- 지갑 주소 유효성 검증 (형식 검증만)
- 개인 지갑으로 분류 및 저장
- 일일 입/출금 한도 설정 (각각 100만원 미만)
- 별도의 소유권 확인 절차 없음
```

#### VASP 지갑 등록

```
- 지갑 주소 유효성 검증
- VASP 여부 확인
- 트래블룰 시스템 연동 가능 여부 검증
- VASP 정보 저장 (사업자명, 트래블룰 연동 상태 등)
- 입/출금 한도 제한 없음
```

## 2. 입금/출금 프로세스

### 2.1 개인 지갑 입금

```pseudocode
IF 지갑_유형 == "개인지갑":
    오늘_입금_총액 = 조회_일일_입금액(wallet_address, 오늘)

    IF (오늘_입금_총액 + 현재_입금액) >= 1,000,000원:
        입금 거부
        에러 메시지: "개인 지갑은 일일 100만원 미만만 입금 가능합니다.
                    오늘 입금 가능 금액: {1,000,000 - 오늘_입금_총액}원"
    ELSE:
        입금 진행
```

### 2.2 개인 지갑 출금

```pseudocode
IF 지갑_유형 == "개인지갑":
    오늘_출금_총액 = 조회_일일_출금액(wallet_address, 오늘)

    IF (오늘_출금_총액 + 현재_출금액) >= 1,000,000원:
        출금 거부
        에러 메시지: "개인 지갑은 일일 100만원 미만만 출금 가능합니다.
                    오늘 출금 가능 금액: {1,000,000 - 오늘_출금_총액}원"
    ELSE:
        출금 진행
```

### 2.3 VASP 지갑 출금

```pseudocode
IF 지갑_유형 == "VASP":
    트래블룰 정보 수집:
        - 송신인 정보 (이름, 주소, 계좌번호 등)
        - 수신인 정보 (이름, VASP 정보 등)
        - 거래 정보 (금액, 자산 종류 등)

    트래블룰 메시지 전송
    출금 진행
```

## 3. 트래블룰 관련 메시지

출금 시 사용자에게 표시할 트래블룰 안내 메시지:

```
"트래블룰 안내

본 거래는 특정금융정보법에 따라 트래블룰이 적용됩니다.
다음 정보가 수신 VASP에 전송됩니다:

• 송신인 정보: 성명, 가상자산 주소
• 수신인 정보: 성명 또는 식별정보
• 거래 정보: 거래일시, 금액, 자산 종류

이는 자금세탁방지 및 테러자금조달 방지를 위한 법적 의무사항입니다."
```

## 4. 주요 검증 로직

### 지갑 등록 시

- **블록체인별 주소 형식 검증**
- **이미 등록된 주소인지 확인**
- **VASP 목록 대조 확인**
- **개인 지갑은 추가 검증 없이 바로 등록**

### 입/출금 요청 시

- **등록된 지갑인지 확인**
- **개인 지갑의 경우:**
  - 일일 입금 누적액 + 현재 입금액 < 100만원
  - 일일 출금 누적액 + 현재 출금액 < 100만원
  - 한도 초과 시 잔여 가능 금액 안내
- **VASP 지갑의 경우 트래블룰 정보 완성도 확인**

### 일일 한도 리셋

- **매일 00:00 (KST) 기준으로 일일 한도 초기화**
- **또는 최초 거래 시점부터 24시간 기준 적용 (정책 결정 필요)**

---

## 5. 구현 대상 페이지

- **URL**: `http://localhost:3000/security/addresses`
- **현재 상태**: 출금/입금 주소 화이트리스트 통합 리팩토링 완료
- **추가 구현 필요**: 위 요구사항에 따른 지갑 등록 시스템 로직

## 6. 기술적 고려사항

### 6.1 데이터 모델 확장

```typescript
interface WhitelistedAddress {
  // 기존 필드들...

  // 새로 추가될 필드들
  dailyLimits?: {
    deposit: number;    // 일일 입금 한도 (개인지갑: 1,000,000원)
    withdrawal: number; // 일일 출금 한도 (개인지갑: 1,000,000원)
  };

  vaspInfo?: {
    businessName: string;        // VASP 사업자명
    travelRuleConnected: boolean; // 트래블룰 연동 상태
    registrationNumber: string;   // 사업자 등록번호
  };

  dailyUsage?: {
    date: string;           // 날짜 (YYYY-MM-DD)
    depositAmount: number;  // 당일 입금액
    withdrawalAmount: number; // 당일 출금액
  };
}
```

### 6.2 API 엔드포인트 (예상)

- `POST /api/wallets/validate` - 지갑 주소 유효성 검증
- `POST /api/wallets/register` - 지갑 등록
- `GET /api/wallets/daily-limits/:address` - 일일 한도 조회
- `POST /api/transactions/validate` - 거래 전 검증
- `POST /api/travel-rule/collect` - 트래블룰 정보 수집

### 6.3 UI/UX 개선사항

- 지갑 등록 시 유형 선택 UI
- 일일 한도 표시 및 잔여 한도 안내
- 트래블룰 안내 모달
- 개인/VASP 지갑별 차별화된 아이콘 및 배지
- 실시간 한도 사용량 표시