# 📋 출금 관리 - 필수 결재자 수 개선 계획

## 🔍 현재 상황 분석

### 데이터 구조
- **타입 정의**: `requiredApprovals: string[]` - 필수 결재자 이름 배열
- **현재 샘플 데이터 분포**:
  - 1명 결재자: `["박CFO"]` (7건) - **문제점: 보안상 부적절**
  - 2명 결재자: `["박CFO", "이CISO"]` (3건)  
  - 3명 결재자: `["박CFO", "이CISO", "김CTO"]` (1건)

### 문제점
1. **보안 취약**: 1명 결재자로는 내부 통제 부족
2. **다양성 부족**: 대부분 1명 또는 2명 결재자만 존재
3. **금액별 차등 적용 없음**: 거래 규모와 관계없이 동일한 결재 정책

---

## 🎯 개선 방향

### 핵심 원칙
- **최소 2명 이상 결재**: 내부 통제 강화
- **금액별 차등 적용**: 위험도에 따른 결재자 수 조정
- **역할 기반 결재**: 각 결재자의 전문 영역 고려

---

## 📊 단계별 개선 계획

### 1단계: 샘플 데이터 다양화 (즉시 적용 가능)

#### Before (현재)
```typescript
requiredApprovals: ["박CFO"] // ❌ 1명만 - 보안상 부적절
```

#### After (개선 후)
```typescript
// 기본 거래 (최소 2명)
requiredApprovals: ["박CFO", "이CISO"]

// 고액 거래 (3명)  
requiredApprovals: ["박CFO", "이CISO", "김CTO"]

// 초고액 거래 (4명)
requiredApprovals: ["박CFO", "이CISO", "김CTO", "최법무팀장"]

// 임계 거래 (5명)
requiredApprovals: ["박CFO", "이CISO", "김CTO", "최법무팀장", "정CEO"]
```

### 2단계: 금액별 결재 정책 설계

| 거래 금액 (KRW) | 결재자 수 | 필수 역할 |
|-----------------|-----------|-----------|
| 100만원 미만 | **2명** | 팀장 + 부서장 |
| 1000만원 미만 | **3명** | 팀장 + 부서장 + CFO |
| 1억원 미만 | **4명** | 팀장 + 부서장 + CFO + CISO |
| 1억원 이상 | **5명** | 팀장 + 부서장 + CFO + CISO + CEO |

### 3단계: UI 컴포넌트 개선

#### 승인 진행률 표시 개선
```typescript
// 현재: 단순 숫자 + 진행바
"2/3" + ProgressBar

// 개선: 개별 결재자 상태 + 아이콘
"박CFO(✅) 이CISO(✅) 김CTO(⏳)"
```

#### 결재 상세 화면 개선
- **현재**: 단순 목록 형태
- **개선**: 타임라인 형태로 승인 순서/시간 표시

---

## 📊 프로젝트 진행 현황

### 전체 진행률: 0% (0/9 완료)
- ✅ **완료**: 0개
- 🔄 **진행중**: 0개  
- ⏳ **대기중**: 9개

---

## 🚀 실행 우선순위

### 🔥 High Priority (즉시 적용) - 1주일
> **목표 기간**: 2025-01-15 ~ 2025-01-22  
> **진행률**: 0% (0/3 완료)

| 상태 | 작업명 | 담당자 | 시작일 | 완료일 | 비고 |
|------|--------|--------|--------|--------|------|
| ⏳ | **샘플 데이터 수정**: 1명 결재자 → 최소 2명으로 변경 | - | - | - | WithdrawalManagement.tsx 수정 |
| ⏳ | **다양한 시나리오 추가**: 2명/3명/4명/5명 결재 케이스 생성 | - | - | - | 최소 10개 이상 케이스 |
| ⏳ | **기존 UI 호환성 확인**: 변경된 데이터로 정상 동작 검증 | - | - | - | 빌드 테스트 및 기능 검증 |

### 📈 Medium Priority (단기 개선) - 2-4주  
> **목표 기간**: 2025-01-22 ~ 2025-02-19  
> **진행률**: 0% (0/3 완료)

| 상태 | 작업명 | 담당자 | 시작일 | 완료일 | 비고 |
|------|--------|--------|--------|--------|------|
| ⏳ | **UI 개선**: 개별 결재자 상태 표시 컴포넌트 | - | - | - | ApprovalStatus 컴포넌트 신규 |
| ⏳ | **승인 타임라인**: 시간순 결재 진행 상황 시각화 | - | - | - | Timeline 컴포넌트 개발 |
| ⏳ | **결재자 역할 표시**: CFO, CISO 등 역할별 구분 | - | - | - | 역할 뱃지 컴포넌트 |

### 🎯 Low Priority (장기 개선) - 2-3개월
> **목표 기간**: 2025-02-19 ~ 2025-04-15  
> **진행률**: 0% (0/3 완료)

| 상태 | 작업명 | 담당자 | 시작일 | 완료일 | 비고 |
|------|--------|--------|--------|--------|------|
| ⏳ | **동적 결재자 할당**: 금액 기반 자동 결재자 선정 | - | - | - | 정책 엔진 설계 필요 |
| ⏳ | **결재 정책 엔진**: 설정 가능한 결재 규칙 시스템 | - | - | - | 관리자 설정 UI 포함 |
| ⏳ | **알림 시스템**: 결재 대기자 자동 알림 기능 | - | - | - | 이메일/슬랙 연동 고려 |

---

## 📝 진행 상황 업데이트 가이드

### 상태 표시 규칙
- ⏳ **대기중**: 아직 시작하지 않음
- 🔄 **진행중**: 작업 진행 중
- ✅ **완료**: 작업 완료 및 검증 완료
- ❌ **보류**: 일시 중단 또는 블로커 발생
- 🔁 **재작업**: 수정이 필요하여 다시 진행

### 업데이트 방법
1. **작업 시작시**: 상태를 ⏳ → 🔄 변경, 시작일 입력
2. **작업 완료시**: 상태를 🔄 → ✅ 변경, 완료일 입력  
3. **문제 발생시**: 상태를 ❌ 변경, 비고에 이슈 내용 기록
4. **진행률 업데이트**: 각 섹션별 완료된 작업 수 / 전체 작업 수로 계산

### 주간 리뷰 템플릿
```markdown
## 📅 Week N (2025-MM-DD ~ 2025-MM-DD) 진행 보고

### ✅ 이번 주 완료
- [ ] 작업명 1
- [ ] 작업명 2

### 🔄 진행 중
- [ ] 작업명 3 (진행률: 50%)

### ⚠️ 이슈 및 블로커
- 이슈 1: 설명
- 이슈 2: 설명

### 📋 다음 주 계획
- [ ] 작업명 4
- [ ] 작업명 5
```

---

## 💻 구현 예시 코드

### 금액별 결재자 할당 함수
```typescript
function getRequiredApprovers(amount: number, currency: string): string[] {
  const krwAmount = convertToKRW(amount, currency);
  
  if (krwAmount >= 100000000) { // 1억원 이상
    return ["박CFO", "이CISO", "김CTO", "최법무팀장", "정CEO"];
  } else if (krwAmount >= 10000000) { // 1천만원 이상  
    return ["박CFO", "이CISO", "김CTO", "최법무팀장"];
  } else if (krwAmount >= 1000000) { // 100만원 이상
    return ["박CFO", "이CISO", "김CTO"];
  } else {
    return ["박CFO", "이CISO"]; // 최소 2명
  }
}
```

### 개선된 승인 상태 컴포넌트
```typescript
interface ApprovalStatusProps {
  requiredApprovals: string[];
  approvals: Approval[];
}

function ApprovalStatus({ requiredApprovals, approvals }: ApprovalStatusProps) {
  return (
    <div className="flex items-center space-x-2">
      {requiredApprovals.map((approver) => {
        const isApproved = approvals.some(a => a.userName === approver);
        return (
          <div key={approver} className="flex items-center">
            {isApproved ? (
              <CheckCircleIcon className="h-4 w-4 text-green-500" />
            ) : (
              <ClockIcon className="h-4 w-4 text-yellow-500" />
            )}
            <span className="text-xs ml-1">{approver}</span>
          </div>
        );
      })}
    </div>
  );
}
```

---

## 📈 기대 효과

### 보안성 강화
- **내부 통제 향상**: 최소 2명 이상의 교차 검증
- **권한 분산**: 단일 결재자 의존도 제거
- **감사 추적**: 다단계 승인 프로세스 투명성

### 사용자 경험 개선  
- **직관적 UI**: 결재자별 상태 한눈에 파악
- **실시간 진행률**: 승인 대기 현황 명확히 표시
- **역할 기반 표시**: 각 결재자의 전문성 확인 가능

### 운영 효율성
- **자동화**: 금액별 결재자 자동 할당
- **정책 적용**: 일관된 결재 규칙 적용
- **확장성**: 새로운 역할/정책 쉽게 추가 가능

---

## 📝 참고 사항

- **기존 코드 호환성**: 현재 `requiredApprovals: string[]` 구조 유지
- **점진적 적용**: 1단계부터 순차 적용으로 안정성 확보  
- **테스트 필수**: 각 단계별 충분한 테스트 후 적용
- **사용자 피드백**: 개선 사항에 대한 지속적인 모니터링

---

## 📈 변경 이력

| 날짜 | 버전 | 변경 내용 | 작성자 |
|------|------|-----------|--------|
| 2025-01-15 | v1.0 | 초기 계획서 작성 | Claude |
| 2025-01-15 | v1.1 | 진행 상황 추적 구조 추가 | Claude |

---

## 📋 체크리스트 요약

### 즉시 해야 할 일 (이번 주)
- [ ] WithdrawalManagement.tsx에서 1명 결재자 케이스 모두 찾아서 2명 이상으로 변경
- [ ] 다양한 금액대별 시나리오 최소 10개 생성 (1천만원, 1억원, 10억원 등)
- [ ] npm run build 실행하여 타입 에러 없음 확인
- [ ] 각 탭에서 다중 결재자 UI 정상 표시 확인

### 다음 우선순위 (다음 주~)  
- [ ] ApprovalStatus 컴포넌트 설계 및 구현
- [ ] 결재자별 개별 상태 표시 (이름 + 아이콘)
- [ ] 시간순 승인 타임라인 UI 설계

---

*📅 작성일: 2025-01-15*  
*🔄 마지막 수정: 2025-01-15*  
*📊 현재 진행률: 0/9 (0%)*